<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DOcoin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        body {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            touch-action: manipulation;
        }
        
        .container {
            width: 100%;
            max-width: 400px;
            background: rgba(30, 30, 30, 0.95);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 0 40px rgba(200, 0, 0, 0.3);
            border: 1px solid #500;
            position: relative;
            overflow: hidden;
        }
        
        .header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #500;
            position: relative;
        }
        
        .header h1 {
            font-size: 2.5em;
            font-weight: bold;
            color: #ff2a2a;
            text-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
            letter-spacing: 2px;
        }
        
        .balance-section {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 15px;
            border: 1px solid #333;
        }
        
        .balance-label {
            color: #ff2a2a;
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        
        .balance {
            font-size: 2.5em;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 15px rgba(255, 0, 0, 0.7);
        }
        
        .currency {
            font-size: 0.6em;
            color: #ff2a2a;
            vertical-align: super;
        }
        
        .mine-section {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .mine-button {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: linear-gradient(145deg, #ff2a2a, #800);
            border: none;
            color: white;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 0 10px 25px rgba(255, 0, 0, 0.4);
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
            touch-action: manipulation;
        }
        
        .mine-button:active {
            transform: scale(0.95);
            box-shadow: 0 5px 15px rgba(255, 0, 0, 0.3);
        }
        
        .mine-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }
        
        .stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 15px;
            border: 1px solid #333;
        }
        
        .stat {
            text-align: center;
            flex: 1;
        }
        
        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #ff2a2a;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9em;
            color: #aaa;
        }
        
        .auto-mine-status {
            text-align: center;
            margin-bottom: 20px;
            padding: 10px;
            background: rgba(40, 0, 0, 0.5);
            border-radius: 10px;
            border: 1px solid #500;
        }
        
        .auto-mine-text {
            color: #ff2a2a;
            font-weight: bold;
        }
        
        .menu {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .menu-item {
            background: rgba(40, 0, 0, 0.5);
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid #500;
        }
        
        .menu-item:hover {
            background: rgba(60, 0, 0, 0.7);
            transform: translateY(-3px);
        }
        
        .menu-icon {
            font-size: 1.8em;
            color: #ff2a2a;
            margin-bottom: 10px;
        }
        
        .menu-text {
            font-size: 0.9em;
            font-weight: bold;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: rgba(20, 20, 20, 0.95);
            color: #ff2a2a;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            transition: transform 0.4s ease;
            border: 1px solid #500;
            font-weight: bold;
            text-align: center;
            z-index: 1000;
            min-width: 250px;
        }
        
        .notification.show {
            transform: translateX(-50%) translateY(0);
        }
        
        .footer {
            text-align: center;
            margin-top: 20px;
            color: #666;
            font-size: 0.8em;
        }
        
        /* Стили для модальных окон */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: rgba(30, 30, 30, 0.95);
            border-radius: 15px;
            padding: 20px;
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid #500;
            box-shadow: 0 0 30px rgba(200, 0, 0, 0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #500;
        }
        
        .modal-title {
            color: #ff2a2a;
            font-size: 1.5em;
            font-weight: bold;
        }
        
        .close-modal {
            background: none;
            border: none;
            color: #fff;
            font-size: 1.5em;
            cursor: pointer;
        }
        
        .task-item {
            background: rgba(40, 0, 0, 0.5);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border: 1px solid #500;
        }
        
        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .task-name {
            font-weight: bold;
            color: #ff2a2a;
        }
        
        .task-reward {
            background: #ff2a2a;
            color: #000;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .task-description {
            font-size: 0.9em;
            color: #aaa;
            margin-bottom: 10px;
        }
        
        .task-progress {
            width: 100%;
            height: 10px;
            background: #300;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 5px;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #ff2a2a, #800);
            border-radius: 5px;
            transition: width 0.3s ease;
        }
        
        .task-status {
            display: flex;
            justify-content: space-between;
            font-size: 0.8em;
            color: #aaa;
        }
        
        .task-completed {
            background: rgba(0, 80, 0, 0.5);
            border-color: #080;
        }
        
        .task-completed .task-name {
            color: #0f0;
        }
        
        .task-completed .progress-bar {
            background: linear-gradient(90deg, #0f0, #080);
        }
        
        .telegram-link {
            display: block;
            text-align: center;
            background: #0088cc;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            margin-top: 10px;
            transition: background 0.3s;
        }
        
        .telegram-link:hover {
            background: #006699;
        }
        
        .upgrade-item {
            background: rgba(40, 0, 0, 0.5);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 1px solid #500;
        }
        
        .upgrade-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .upgrade-name {
            font-weight: bold;
            color: #ff2a2a;
        }
        
        .upgrade-price {
            background: #ff2a2a;
            color: #000;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .upgrade-description {
            font-size: 0.9em;
            color: #aaa;
            margin-bottom: 10px;
        }
        
        .upgrade-button {
            width: 100%;
            padding: 10px;
            background: linear-gradient(45deg, #ff2a2a, #800);
            color: white;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upgrade-button:hover {
            background: linear-gradient(45deg, #ff4040, #a00);
        }
        
        .upgrade-button:disabled {
            background: #555;
            cursor: not-allowed;
        }
        
        .loader {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .loader-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255, 42, 42, 0.3);
            border-radius: 50%;
            border-top: 5px solid #ff2a2a;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Анимация монетки */
        @keyframes coinAnimation {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .coin-animation {
            animation: coinAnimation 0.3s ease;
        }
        
        /* Предотвращение масштабирования при двойном тапе */
        @media (max-width: 768px) {
            .mine-button {
                -webkit-user-select: none;
                -webkit-tap-highlight-color: transparent;
            }
        }
        
        .error-message {
            color: #ff2a2a;
            text-align: center;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .success-message {
            color: #0f0;
            text-align: center;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .completed-icon {
            color: #0f0;
            margin-left: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>DOcoin</h1>
        </div>
        
        <div class="balance-section">
            <div class="balance-label">Ваш баланс</div>
            <div class="balance" id="balance">0.0000 <span class="currency">DOcoin</span></div>
        </div>
        
        <div class="mine-section">
            <button class="mine-button" id="mineButton">
                <div class="mine-icon"><i class="fas fa-coins"></i></div>
                <div>Майнить!</div>
            </button>
        </div>
        
        <div class="auto-mine-status">
            <div class="auto-mine-text" id="autoMineStatus">Автомайнинг: выключен</div>
        </div>
        
        <div class="stats">
            <div class="stat">
                <div class="stat-value" id="power">1</div>
                <div class="stat-label">Мощность</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="income">0/ч</div>
                <div class="stat-label">Заработок</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="level">1</div>
                <div class="stat-label">Уровень</div>
            </div>
        </div>
        
        <div class="menu">
            <div class="menu-item" onclick="openModal('shop')">
                <div class="menu-icon"><i class="fas fa-store"></i></div>
                <div class="menu-text">Магазин</div>
            </div>
            <div class="menu-item" onclick="openModal('upgrades')">
                <div class="menu-icon"><i class="fas fa-arrow-up"></i></div>
                <div class="menu-text">Улучшения</div>
            </div>
            <div class="menu-item" onclick="openModal('tasks')">
                <div class="menu-icon"><i class="fas fa-tasks"></i></div>
                <div class="menu-text">Задания</div>
            </div>
            <div class="menu-item" onclick="openModal('referral')">
                <div class="menu-icon"><i class="fas fa-users"></i></div>
                <div class="menu-text">Рефералы</div>
            </div>
            <div class="menu-item" onclick="openModal('withdraw')">
                <div class="menu-icon"><i class="fas fa-wallet"></i></div>
                <div class="menu-text">Вывод</div>
            </div>
            <div class="menu-item" onclick="openModal('settings')">
                <div class="menu-icon"><i class="fas fa-cog"></i></div>
                <div class="menu-text">Настройки</div>
            </div>
        </div>
        
        <div class="footer">
            DOcoin © 2023. Все права защищены.
        </div>
    </div>

    <!-- Модальное окно заданий -->
    <div class="modal" id="tasks-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Задания</h2>
                <button class="close-modal" onclick="closeModal('tasks')">&times;</button>
            </div>
            <div class="task-list">
                <div class="task-item" id="task1">
                    <div class="task-header">
                        <div class="task-name">Подписка на Telegram</div>
                        <div class="task-reward">+5 DOcoin</div>
                    </div>
                    <div class="task-description">Подпишитесь на наш Telegram-канал</div>
                    <a href="https://t.me/+bFN-tmt4SsVjMDIy" target="_blank" class="telegram-link" id="telegram-link">
                        <i class="fab fa-telegram"></i> Перейти в Telegram
                    </a>
                    <div class="task-progress">
                        <div class="progress-bar" id="task1-progress" style="width: 0%;"></div>
                    </div>
                    <div class="task-status">
                        <span>Прогресс:</span>
                        <span id="task1-status">Не выполнено</span>
                    </div>
                </div>
                
                <div class="task-item" id="task2">
                    <div class="task-header">
                        <div class="task-name">Ежедневный вход</div>
                        <div class="task-reward">+10 DOcoin</div>
                    </div>
                    <div class="task-description">Заходите в игру 7 дней подряд</div>
                    <div class="task-progress">
                        <div class="progress-bar" id="task2-progress" style="width: 0%;"></div>
                    </div>
                    <div class="task-status">
                        <span>Прогресс:</span>
                        <span id="task2-status">0/7 дней</span>
                    </div>
                </div>
                
                <div class="task-item" id="task3">
                    <div class="task-header">
                        <div class="task-name">Майнинг-марафон</div>
                        <div class="task-reward">+20 DOcoin</div>
                    </div>
                    <div class="task-description">Намайните 100 DOcoin</div>
                    <div class="task-progress">
                        <div class="progress-bar" id="task3-progress" style="width: 0%;"></div>
                    </div>
                    <div class="task-status">
                        <span>Прогресс:</span>
                        <span id="task3-status">0/100 DOcoin</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно улучшений -->
    <div class="modal" id="upgrades-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Улучшения майнера</h2>
                <button class="close-modal" onclick="closeModal('upgrades')">&times;</button>
            </div>
            <div id="upgrades-list">
                <!-- Улучшения будут добавляться здесь -->
            </div>
            <div id="upgrade-message"></div>
        </div>
    </div>

    <!-- Остальные модальные окна -->
    <div class="modal" id="shop-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Магазин</h2>
                <button class="close-modal" onclick="closeModal('shop')">&times;</button>
            </div>
            <p style="text-align: center; color: #aaa; padding: 20px;">Магазин скоро откроется!</p>
        </div>
    </div>

    <div class="modal" id="referral-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Рефералы</h2>
                <button class="close-modal" onclick="closeModal('referral')">&times;</button>
            </div>
            <p style="text-align: center; color: #aaa; padding: 20px;">Реферальная программа скоро будет доступна!</p>
        </div>
    </div>

    <div class="modal" id="withdraw-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Вывод средств</h2>
                <button class="close-modal" onclick="closeModal('withdraw')">&times;</button>
            </div>
            <p style="text-align: center; color: #aaa; padding: 20px;">Функция вывода скоро будет доступна!</p>
        </div>
    </div>

    <div class="modal" id="settings-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Настройки</h2>
                <button class="close-modal" onclick="closeModal('settings')">&times;</button>
            </div>
            <div class="settings-list">
                <div class="settings-item">
                    <div class="settings-name">Уведомления</div>
                    <label class="switch">
                        <input type="checkbox" id="notifications" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="settings-item">
                    <div class="settings-name">Звуковые эффекты</div>
                    <label class="switch">
                        <input type="checkbox" id="sound" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="settings-item">
                    <div class="settings-name">Виброотклик</div>
                    <label class="switch">
                        <input type="checkbox" id="vibration">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="settings-item">
                    <div class="settings-name">Темная тема</div>
                    <label class="switch">
                        <input type="checkbox" id="theme" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="settings-item">
                    <div class="settings-name">Авто-майнинг</div>
                    <label class="switch">
                        <input type="checkbox" id="autominer">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </div>
    </div>

    <!-- Индикатор загрузки -->
    <div class="loader" id="loader">
        <div class="loader-spinner"></div>
    </div>

    <script>
        // Основные переменные
        let balance = 0;
        let power = 1;
        let level = 1;
        let income = 0;
        let autoMineInterval = null;
        let autoMineEnabled = false;
        let currentProduct = null;
        let orders = [];
        let lastVisitDate = null;
        let consecutiveDays = 0;
        let totalMined = 0;
        let baseMiningRate = 0.0045; // Увеличен в 15 раз (0.0003 * 15)
        let miningMultiplier = 1;
        let currentUpgradeLevel = 0;
        let currentUpgradePrice = 15;
        let telegramTaskCompleted = false;
        
        const mineButton = document.getElementById('mineButton');
        const balanceDisplay = document.getElementById('balance');
        const powerDisplay = document.getElementById('power');
        const incomeDisplay = document.getElementById('income');
        const levelDisplay = document.getElementById('level');
        const autoMineStatus = document.getElementById('autoMineStatus');
        const autoMineSwitch = document.getElementById('autominer');
        const loader = document.getElementById('loader');
        const telegramLink = document.getElementById('telegram-link');
        
        // Инициализация
        function init() {
            // Загрузка сохраненных данных
            const savedData = localStorage.getItem('docoinGameData');
            if (savedData) {
                const data = JSON.parse(savedData);
                balance = data.balance || 0;
                power = data.power || 1;
                level = data.level || 1;
                income = data.income || 0;
                autoMineEnabled = data.autoMineEnabled || false;
                orders = data.orders || [];
                lastVisitDate = data.lastVisitDate || null;
                consecutiveDays = data.consecutiveDays || 0;
                totalMined = data.totalMined || 0;
                miningMultiplier = data.miningMultiplier || 1;
                currentUpgradeLevel = data.currentUpgradeLevel || 0;
                currentUpgradePrice = data.currentUpgradePrice || 15;
                telegramTaskCompleted = data.telegramTaskCompleted || false;
                
                // Проверка ежедневного входа
                checkDailyLogin();
                
                // Установка переключателя автомайнинга
                autoMineSwitch.checked = autoMineEnabled;
                updateAutoMineStatus();
                
                // Обновление улучшений
                updateUpgradesList();
                
                // Обновление прогресса заданий
                updateTasksProgress();
                
                // Запуск автомайнинга если он был включен
                if (autoMineEnabled) {
                    startAutoMine();
                }
            }
            
            updateDisplay();
            
            // Обработчик изменения переключателя автомайнинга
            autoMineSwitch.addEventListener('change', function() {
                autoMineEnabled = this.checked;
                updateAutoMineStatus();
                saveGameData();
                
                if (autoMineEnabled) {
                    startAutoMine();
                } else {
                    stopAutoMine();
                }
            });
            
            // Обработчик для ссылки Telegram
            telegramLink.addEventListener('click', function() {
                if (!telegramTaskCompleted) {
                    completeTelegramTask();
                }
            });
        }
        
        // Проверка ежедневного входа
        function checkDailyLogin() {
            const today = new Date().toDateString();
            
            if (lastVisitDate !== today) {
                if (lastVisitDate) {
                    const lastVisit = new Date(lastVisitDate);
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                    
                    if (lastVisit.toDateString() === yesterday.toDateString()) {
                        consecutiveDays++;
                    } else {
                        consecutiveDays = 1;
                    }
                } else {
                    consecutiveDays = 1;
                }
                
                lastVisitDate = today;
                updateTasksProgress();
                saveGameData();
            }
        }
        
        // Функция майнинга
        mineButton.addEventListener('click', function() {
            mineCoins();
            
            // Анимация нажатия
            this.style.transform = 'scale(0.95)';
            setTimeout(() => {
                this.style.transform = 'scale(1)';
            }, 150);
        });
        
        // Функция добычи монет
        function mineCoins() {
            const minedAmount = baseMiningRate * power * miningMultiplier;
            balance += minedAmount;
            totalMined += minedAmount;
            
            updateDisplay();
            updateTasksProgress();
            saveGameData();
            
            // Анимация баланса
            balanceDisplay.classList.add('coin-animation');
            setTimeout(() => {
                balanceDisplay.classList.remove('coin-animation');
            }, 300);
        }
        
        // Запуск автомайнинга
        function startAutoMine() {
            if (autoMineInterval) {
                clearInterval(autoMineInterval);
            }
            
            // Майнинг каждые 5 секунд
            autoMineInterval = setInterval(() => {
                mineCoins();
            }, 5000);
        }
        
        // Остановка автомайнинга
        function stopAutoMine() {
            if (autoMineInterval) {
                clearInterval(autoMineInterval);
                autoMineInterval = null;
            }
        }
        
        // Обновление статуса автомайнинга
        function updateAutoMineStatus() {
            if (autoMineEnabled) {
                autoMineStatus.textContent = `Автомайнинг: включен (+${(baseMiningRate * power * miningMultiplier * 12).toFixed(4)}/мин)`;
                autoMineStatus.style.color = '#0f0';
            } else {
                autoMineStatus.textContent = 'Автомайнинг: выключен';
                autoMineStatus.style.color = '#ff2a2a';
            }
        }
        
        // Обновление отображения
        function updateDisplay() {
            balanceDisplay.textContent = balance.toFixed(4);
            powerDisplay.textContent = power;
            incomeDisplay.textContent = (income * miningMultiplier).toFixed(4) + '/ч';
            levelDisplay.textContent = level;
        }
        
        // Обновление прогресса заданий
        function updateTasksProgress() {
            // Задание 1 - Подписка на Telegram
            const task1Progress = document.getElementById('task1-progress');
            const task1Status = document.getElementById('task1-status');
            
            if (telegramTaskCompleted) {
                task1Progress.style.width = '100%';
                task1Status.innerHTML = 'Выполнено <i class="fas fa-check completed-icon"></i>';
                document.getElementById('task1').classList.add('task-completed');
                telegramLink.style.display = 'none';
            } else {
                task1Progress.style.width = '0%';
                task1Status.textContent = 'Не выполнено';
            }
            
            // Задание 2 - Ежедневный вход
            const task2Progress = document.getElementById('task2-progress');
            const task2Status = document.getElementById('task2-status');
            const progressPercent = Math.min(100, (consecutiveDays / 7) * 100);
            
            task2Progress.style.width = `${progressPercent}%`;
            task2Status.textContent = `${consecutiveDays}/7 дней`;
            
            if (consecutiveDays >= 7) {
                document.getElementById('task2').classList.add('task-completed');
                task2Status.innerHTML = 'Выполнено <i class="fas fa-check completed-icon"></i>';
                
                // Награда за выполнение
                if (consecutiveDays === 7) {
                    balance += 10;
                    showNotification('+10 DOcoin за ежедневный вход!');
                    updateDisplay();
                    saveGameData();
                }
            }
            
            // Задание 3 - Майнинг-марафон
            const task3Progress = document.getElementById('task3-progress');
            const task3Status = document.getElementById('task3-status');
            const minedPercent = Math.min(100, (totalMined / 100) * 100);
            
            task3Progress.style.width = `${minedPercent}%`;
            task3Status.textContent = `${totalMined.toFixed(2)}/100 DOcoin`;
            
            if (totalMined >= 100) {
                document.getElementById('task3').classList.add('task-completed');
                task3Status.innerHTML = 'Выполнено <i class="fas fa-check completed-icon"></i>';
                
                // Награда за выполнение
                if (totalMined >= 100 && totalMined < 100.1) {
                    balance += 20;
                    showNotification('+20 DOcoin за майнинг-марафон!');
                    updateDisplay();
                    saveGameData();
                }
            }
        }
        
        // Завершение задания Telegram
        function completeTelegramTask() {
            telegramTaskCompleted = true;
            balance += 5;
            
            updateTasksProgress();
            updateDisplay();
            saveGameData();
            
            showNotification('+5 DOcoin за подписку на Telegram!');
        }
        
        // Обновление списка улучшений
        function updateUpgradesList() {
            const upgradesList = document.getElementById('upgrades-list');
            upgradesList.innerHTML = '';
            
            const upgradeElement = document.createElement('div');
            upgradeElement.className = 'upgrade-item';
            
            upgradeElement.innerHTML = `
                <div class="upgrade-header">
                    <div class="upgrade-name">Улучшение майнера Ур.${currentUpgradeLevel + 1}</div>
                    <div class="upgrade-price">${currentUpgradePrice.toFixed(2)} DOcoin</div>
                </div>
                <div class="upgrade-description">
                    +5% к добыче за клик
                </div>
                <button class="upgrade-button" onclick="buyUpgrade()" 
                        ${balance < currentUpgradePrice ? 'disabled' : ''}>
                    Купить улучшение
                </button>
            `;
            
            upgradesList.appendChild(upgradeElement);
        }
        
        // Покупка улучшения
        function buyUpgrade() {
            if (balance < currentUpgradePrice) {
                showMessage('К сожалению, недостаточно средств для покупки улучшения', 'error');
                return;
            }
            
            showLoader();
            
            setTimeout(() => {
                balance -= currentUpgradePrice;
                miningMultiplier += 0.05; // +5% к добыче
                currentUpgradeLevel++;
                currentUpgradePrice *= 1.3; // Увеличиваем цену на 30%
                
                updateDisplay();
                updateUpgradesList();
                saveGameData();
                hideLoader();
                
                showMessage('Вы успешно улучшили майнер!', 'success');
            }, 1000);
        }
        
        // Показать сообщение
        function showMessage(message, type) {
            const messageElement = document.getElementById('upgrade-message');
            messageElement.textContent = message;
            messageElement.className = type === 'error' ? 'error-message' : 'success-message';
            
            setTimeout(() => {
                messageElement.textContent = '';
            }, 3000);
        }
        
        // Показать уведомление
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 400);
            }, 3000);
        }
        
        // Сохранение данных игры
        function saveGameData() {
            const gameData = {
                balance: balance,
                power: power,
                level: level,
                income: income,
                autoMineEnabled: autoMineEnabled,
                orders: orders,
                lastVisitDate: lastVisitDate,
                consecutiveDays: consecutiveDays,
                totalMined: totalMined,
                miningMultiplier: miningMultiplier,
                currentUpgradeLevel: currentUpgradeLevel,
                currentUpgradePrice: currentUpgradePrice,
                telegramTaskCompleted: telegramTaskCompleted
            };
            localStorage.setItem('docoinGameData', JSON.stringify(gameData));
        }
        
        // Функции для модальных окон
        function openModal(modalType) {
            document.getElementById(modalType + '-modal').style.display = 'flex';
            
            // Если открываем улучшения, обновляем список
            if (modalType === 'upgrades') {
                updateUpgradesList();
            }
        }
        
        function closeModal(modalType) {
            document.getElementById(modalType + '-modal').style.display = 'none';
        }
        
        // Функции загрузки
        function showLoader() {
            loader.style.display = 'flex';
        }
        
        function hideLoader() {
            loader.style.display = 'none';
        }
        
        // Закрытие модальных окон при клике вне их
        window.addEventListener('click', function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });
        
        // Автоматический доход каждый час
        setInterval(() => {
            if (income > 0) {
                balance += income * miningMultiplier;
                updateDisplay();
                saveGameData();
            }
        }, 3600000); // 1 час
        
        // Инициализация при загрузке
        window.addEventListener('load', init);
    </script>
</body>
</html>